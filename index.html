<!DOCTYPE html><html><head>
    <meta charset='utf-8'/>
    
         <title>Rivas</title>   
         <style>
          html { height: 100% }
          body { height: 100%; margin: 0; padding: 0;}
          #map{ height: 100% }
        </style>
        <style>
                .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
                .colorLegend { text-align: left; line-height: 18px; color: #555; } .colorLegend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>
           <!-- Load jQuery and PapaParse to read data from a CSV file -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-40454900-1', 'calvinmetcalf.github.io');
      ga('send', 'pageview');
    
    </script>
      <div id="map"></div>
    <script src="dist/shp.min.js"> </script>
    <script>
    var BaseMap= L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
            'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1
    });
    //adding layers to map
    var m= L.map('map',{ center: [36.563451, -121.956993],zoom: 8,
        layers: [BaseMap]});  
        var baseMaps = {
    "Base Map": BaseMap,
};


    
    var info2 = L.control();
    //var info = L.control();
    // info.onAdd = function (m) {
    //     this._div = L.DomUtil.create('div', 'info');
    //     this.update();
    //     return this._div;
    // };
    // info.update = function (props) {
    //     this._div.innerHTML = '<h4>Broadband Connectivity</h4>' +  (props ?
    //         '<b>' + props.BSL + ''
    //         : 'Hover over a block');
    // };
    // info.addTo(m);
    //get images
    function getImage(NS) {
        return NS === "≤100.000000"   ? "files/c1.JPG" :
        NS === "≤69.517763"  ? "files/c2.JPG" :
        NS === "≤51.919262"  ? "files/c3.JPG" :
        NS === "≤34.302682"   ? "files/c4.JPG"  :   "files/c4.JPG"                                 
    }
    // get color depending on population density value
    function getColor(BSL) {
        return BSL === "Well-served"   ? '#4575B5' :
        BSL === "Under-served"  ? '#C0CCBE' :
        BSL === "Under-served, low population"  ? '#FFFFBF' :
        BSL === "Unserved, low population"   ? '#FAB984' :      
                 '#33322c' ;                          
    }
    function style(feature) {
        return {
            weight: 1,
            opacity: 1,
            color: 'white',
            dashArray: '01',
            fillOpacity: 0.8,
            fillColor: getColor(feature.properties.BSL)
        };
        console.log(feature.properties.level)
    }
    function highlightFeature(e) {
        var layer = e.target;
    
        layer.setStyle({
            weight: 2,
            color: '#100',
            dashArray: '',
            fillOpacity: 0.7
        });
    
        if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
        }
        info.update(layer.feature.properties);
    }
    function highlightFeature2(e) {
        var layer = e.target;
    
        layer.setStyle({
            weight: 2,
            color: '#FF0000',
            dashArray: '',
            fillOpacity: 0
        });
    
        info2.update(layer.feature.properties);
    }
    function resetHighlight(e) {
            geo2.resetStyle(e.target);
            info.update();
        }
    function resetHighlight2(e) {
            geo.resetStyle(e.target);
           // info2.update();
        }
    function zoomToFeature(e) {
            m.fitBounds(e.target.getBounds());
        }
    
    function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }
        
    var geo = L.geoJson({features:[]}, { weight: 1,color: 'black', fillColor: '#f03',fillOpacity: 0 });
    
    var geo2 = L.geoJson({features:[]}, {
            style: style,
           // onEachFeature: onEachFeature
        });
    var lat;
    var lng;
    lat = parseFloat(36.1300452);
    lng = parseFloat(-120.2449273);
    var boundry = 'files/ASL_30-20201208T220924Z-001.zip';
    var track_level='files/Track_level_data.zip';
    shp(track_level).then(function(data){
            geo2.addData(data);
            });
    shp(boundry).then(function(data){
            geo.addData(data);
            });
    var colorLegend = L.control({position: 'bottomright'});
    var scoreLegend = L.control({position: 'bottomright'});
    var infoLegend = L.control({position: 'bottomleft'});
    var toggle= L.control({position: 'topleft'});
    colorLegend.onAdd = function (m) {
        var div = L.DomUtil.create('div', 'info colorLegend'),
            grades = ["Well-served", "Under-served", "Under-served, low population", "Unserved, low population"],
            labels = [],
            from, to;
        for (var i = 0; i < grades.length; i++) {
            from = grades[i];
            to = grades[i + 1];
            labels.push(
                '<i style="background:' + getColor(from) + '"></i> ' + from );
        }
        div.innerHTML = '<h4>Broadband Level Service</h4>' +labels.join('<br>');
        return div;
    };
    scoreLegend.onAdd = function (m) {
        var div = L.DomUtil.create('div', 'info scoreLegend'),
            grades = ["≤100.000000", "≤69.517763", "≤51.919262", "≤34.302682"],
            labels = [],
            from, to;
        for (var i = 0; i < grades.length; i++) {
            from = grades[i];
            to = grades[i + 1];
            labels.push(
                '<img src=' + getImage(from) + ' width="25" height="25"> ' + from );
        }
        div.innerHTML = '<h4>Need Score</h4>' +labels.join('<br>');
        return div;
    }; 
    infoLegend.onAdd = function (m) {
        var div = L.DomUtil.create('div', 'info infoLegend')
        div.innerHTML = '<p><b><i>Need Score</i></b> is a linear combination of the percentages of school age children,<br> Hispanic population, African American population and residents with <br> below-poverty earning using the '+
            '<a href="https://www.census.gov/acs/www/data/data-tables-and-tools/data-profiles/2018/">American Community Survey 2018 data.</a>'+'</p>'+
            '<p><b><i>Broadband Service Level</i></b> is based on the number of providers and speeds <br> available (applying '+
            '<a href="https://sjsugis.maps.arcgis.com/home/item.html?id=b35a011076bf495c8c732e477152207f">Herries (2020)</a>'+
            ' methodology) through Fixed Broadband <br>deployment '+
            '<a href="https://www.fcc.gov/general/broadband-deployment-data-fcc-form-477?contrast=highContrast">data</a>'+
           ' released by the Federal Communication Commission. </p>'+
           '<p>For more information visit '+
            '<a href="https://drive.google.com/file/d/1f2j4z_f9x3G6lX9ULFil6wkEcr0SEM62/view">SJSU’s Report</a>'+
          ' on Internet Access in CA Assembly District 30 </p>'+'<p>© copyright '+
            '<a href="https://www.sjsu.edu/urbanplanning/research-and-public-engagement/savi.php">The SAVI Center at SJSU</a>'
            +'</p>';
        return div;
    }; 
    // var layers = L.layerGroup([BaseMap, geo]);
    // layers.addTo(m);
    var scores = L.layerGroup();
    var tract_colors= L.layerGroup();
    var boundry_line= L.layerGroup();
    geo2.addTo(tract_colors);
    geo.addTo(boundry_line);
    geo2.addTo(m);
    colorLegend.addTo(m);
    scoreLegend.addTo(m);
    infoLegend.addTo(m);
// Read markers data from data.csv
$.get('files/LatLonNeedScore.csv', function(csvString) {
// Use PapaParse to convert string to array of objects
var data = Papa.parse(csvString, {header: true, dynamicTyping: true}).data;
var circle= new Array(data.length)
// For each row in data, create a marker and add it to the map
// For each row, columns `Latitude`, `Longitude`, and `Title` are required
for (var i in data) {
  var row = data[i];
L.circle([parseFloat(row.intptlat), parseFloat(row.intptlon)], {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0,
    weight:  1 ,
    radius: row.NeedScore*100
}).bindPopup("Need Score: "+row.NeedScore).openPopup().addTo(scores);
};
})
var overlayMaps = {
    //"Track Level": tract_colors,
    "Boundary": boundry_line,
    "NeedScores": scores,  
};
L.control.layers(baseMaps,overlayMaps).addTo(m);
scores.setZIndex(7);
</script>
</body>
</html>